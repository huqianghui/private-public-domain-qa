import{j as ge,r as h,a as Ee}from"./react-f6d78ae0.js";import{a as Se,c as Be}from"./react-dom-cf2a9c7d.js";import{L as Me,N as _e,H as De}from"./react-router-dom-d54dc902.js";import{O as $e,d as je,e as X}from"./react-router-25f060bb.js";import{S as ve,A as ye,a as qe,R as Y,b as Qe,C as Oe,c as ze}from"./microsoft-cognitiveservices-speech-sdk-455fe61b.js";import{p as de}from"./dompurify-0c4e1f83.js";import{S as Fe,a as b,I as U,E as He,P as Ge,T as H,B as Ue,b as Ke,c as We,d as ce,e as Ve,f as be,g as Je,h as Ne,D as Te,C as Xe,i as ke,j as J,k as Ye,l as Ze,m as et,n as tt}from"./@fluentui-e834bdeb.js";import{J as nt,i as ot}from"./@react-spring-18c5aa52.js";import"./bent-8a592932.js";import"./@remix-run-222c2c17.js";import"./uuid-a960c1f4.js";import"./tslib-14a4c710.js";import"./@microsoft-31b40247.js";import"./@griffel-f81420e8.js";import"./@emotion-8a8e73f6.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function a(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(n){if(n.ep)return;n.ep=!0;const r=a(n);fetch(n.href,r)}})();const he=ge.Fragment,e=ge.jsx,c=ge.jsxs;const at="/assets/github-fab00c2d.svg",st="_layout_1nrkm_1",rt="_header_1nrkm_7",it="_headerContainer_1nrkm_12",ct="_headerTitleContainer_1nrkm_20",lt="_headerLogo_1nrkm_28",ut="_headerTitle_1nrkm_20",dt="_headerNavList_1nrkm_37",ht="_headerNavPageLink_1nrkm_43",pt="_headerNavPageLinkActive_1nrkm_57",mt="_headerNavLeftMargin_1nrkm_62",gt="_headerRightText_1nrkm_66",_t="_microsoftLogo_1nrkm_71",Ct="_githubLogo_1nrkm_76",T={layout:st,header:rt,headerContainer:it,headerTitleContainer:ct,headerLogo:lt,headerTitle:ut,headerNavList:dt,headerNavPageLink:ht,headerNavPageLinkActive:pt,headerNavLeftMargin:mt,headerRightText:gt,microsoftLogo:_t,githubLogo:Ct},ft=()=>c("div",{className:T.layout,children:[e("header",{className:T.header,role:"banner",children:c("div",{className:T.headerContainer,children:[e(Me,{to:"/",className:T.headerTitleContainer,children:e("h3",{className:T.headerTitle,children:"Bing + GPT + Enterprise data | Sample"})}),e("nav",{children:c("ul",{className:T.headerNavList,children:[e("li",{children:e(_e,{to:"/",className:({isActive:t})=>t?T.headerNavPageLinkActive:T.headerNavPageLink,children:"Chat"})}),e("li",{className:T.headerNavLeftMargin,children:e(_e,{to:"/qa",className:({isActive:t})=>t?T.headerNavPageLinkActive:T.headerNavPageLink,children:"Ask your data"})}),e("li",{className:T.headerNavLeftMargin,children:e("a",{href:"https://aka.ms/entgptsearch",target:"_blank",title:"Github repository link",children:e("img",{src:at,alt:"Github logo","aria-label":"Link to github repository",width:"20px",height:"20px",className:T.githubLogo})})})]})}),e("h4",{className:T.headerRightText,children:"Azure OpenAI + Cognitive Search"})]})}),e($e,{})]}),St=()=>e("h1",{children:"404"}),vt="_oneshotContainer_p6613_1",yt="_oneshotTopSection_p6613_8",bt="_oneshotBottomSection_p6613_15",Nt="_oneshotTitle_p6613_25",Tt="_oneshotQuestionInput_p6613_39",kt="_oneshotAnswerContainer_p6613_46",wt="_oneshotAnalysisPanel_p6613_53",At="_oneshotSettingsSeparator_p6613_58",xt="_settingsButton_p6613_62",y={oneshotContainer:vt,oneshotTopSection:yt,oneshotBottomSection:bt,oneshotTitle:Nt,oneshotQuestionInput:Tt,oneshotAnswerContainer:kt,oneshotAnalysisPanel:wt,oneshotSettingsSeparator:At,settingsButton:xt};async function Rt(t){var i,n,r,l,f,s,m,u;const o=await fetch("/ask",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({question:t.question,approach:t.approach,overrides:{semantic_ranker:(i=t.overrides)==null?void 0:i.semanticRanker,semantic_captions:(n=t.overrides)==null?void 0:n.semanticCaptions,top:(r=t.overrides)==null?void 0:r.top,temperature:(l=t.overrides)==null?void 0:l.temperature,prompt_template:(f=t.overrides)==null?void 0:f.promptTemplate,prompt_template_prefix:(s=t.overrides)==null?void 0:s.promptTemplatePrefix,prompt_template_suffix:(m=t.overrides)==null?void 0:m.promptTemplateSuffix,exclude_category:(u=t.overrides)==null?void 0:u.excludeCategory}})}),a=await o.json();if(o.status>299||!o.ok)throw Error(a.error||"Unknown error");return a}async function Lt(t){var i,n,r,l,f,s,m,u,g;const o=await fetch("/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({history:t.history,approach:t.approach,overrides:{semantic_ranker:(i=t.overrides)==null?void 0:i.semanticRanker,semantic_captions:(n=t.overrides)==null?void 0:n.semanticCaptions,top:(r=t.overrides)==null?void 0:r.top,temperature:(l=t.overrides)==null?void 0:l.temperature,prompt_template:(f=t.overrides)==null?void 0:f.promptTemplate,prompt_template_prefix:(s=t.overrides)==null?void 0:s.promptTemplatePrefix,prompt_template_suffix:(m=t.overrides)==null?void 0:m.promptTemplateSuffix,exclude_category:(u=t.overrides)==null?void 0:u.excludeCategory,suggest_followup_questions:(g=t.overrides)==null?void 0:g.suggestFollowupQuestions}})}),a=await o.json();if(o.status>299||!o.ok)throw Error(a.error||"Unknown error");return a}async function It(t){const o="e985cb0392ad45d59681a396b208ebcf",a="southcentralus";var i=ve.fromSubscription(o,a);const n=ye.fromDefaultSpeakerOutput();i.speechSynthesisVoiceName="zh-CN-YunxiNeural";const r=new qe(i,n),f=t.answer.replace(/\[[^\]]*\]/g,"");console.log(t.answer),r.speakTextAsync(f,function(s){s.reason===Y.SynthesizingAudioCompleted?console.log("synthesis finished."):console.error("Speech synthesis canceled, "+s.errorDetails+`
Did you set the speech resource key and region values?`),r.close()},function(s){console.trace("err - "+s),r.close()})}function Pt(t){return`/content/${t}`}var P=(t=>(t.RetrieveThenRead="rtr",t.ReadRetrieveRead="rrr",t.ReadDecomposeAsk="rda",t))(P||{});const Et="_answerContainer_9j9bn_1",Bt="_answerLogo_9j9bn_9",Mt="_answerText_9j9bn_13",Dt="_selected_9j9bn_22",$t="_citationLearnMore_9j9bn_26",jt="_citation_9j9bn_26",qt="_followupQuestionsList_9j9bn_48",Qt="_followupQuestionLearnMore_9j9bn_52",Ot="_followupQuestion_9j9bn_48",zt="_supContainer_9j9bn_71",Ft="_retryButton_9j9bn_100",Ht="_loadingdots_9j9bn_122",Gt="_loading_9j9bn_122",N={answerContainer:Et,answerLogo:Bt,answerText:Mt,selected:Dt,citationLearnMore:$t,citation:jt,followupQuestionsList:qt,followupQuestionLearnMore:Qt,followupQuestion:Ot,supContainer:zt,retryButton:Ft,loadingdots:Ht,loading:Gt};function Ut(t,o){const a=[],i=[];let n=t.replace(/<<([^>>]+)>>/g,(s,m)=>(i.push(m),""));n=n.trim();const r=n.split(/\[([^\]]+)\]+\(([^\)]+)\)/g);console.log(r);let l=n.match(/\[([^\]]+)\]+\(([^\)]+)\)/g);return console.log(l),l&&l.map((s,m)=>{const u=s.split("]")[0].replace("[",""),g=s.split("]")[1].replace("(","").replace(")","");console.log(u),console.log(g),a.push({id:m,name:u,path:g})}),{answerHtml:r.map((s,m)=>{if(m%3===0)return s;if(m%3==1){let u=a.find(B=>B.name==s),g=u?u.id:-1;g!==-1?g=u?u.id+1:-1:g=a.length;const v=Pt(s);return Se(e("a",{className:"supContainer",title:s,onClick:()=>o(v),children:e("sup",{children:g})}))}else return""}).join(""),citations:a,followupQuestions:i}}function Kt(t){if(t.length==0)return e("table",{});const o=Object.keys(t[0]);let a=new Array;t.map(l=>{a.push(Object.values(l))});const i=a,n=o.map((l,f)=>e("th",{children:l},f)),r=i.map((l,f)=>e("tr",{children:l.map((s,m)=>e("td",{children:s},m))},f));return c("table",{children:[e("thead",{children:e("tr",{children:n})}),e("tbody",{children:r})]})}function Wt(t){return Se(Kt(t))}const pe=()=>e(Fe,{primaryFill:"rgba(115, 118, 225, 1)","aria-hidden":"true","aria-label":"Answer logo"}),we=({answer:t,isSelected:o,onCitationClicked:a,onThoughtProcessClicked:i,onSupportingContentClicked:n,onFollowupQuestionClicked:r,onReadAnswerClicked:l,showFollowupQuestions:f})=>{if(typeof t.answer=="string"){const s=h.useMemo(()=>Ut(t.answer,a),[t]),m=de.sanitize(s.answerHtml);return c(b,{className:`${N.answerContainer} ${o&&N.selected}`,verticalAlign:"space-between",children:[e(b.Item,{children:c(b,{horizontal:!0,horizontalAlign:"space-between",children:[e(pe,{}),c("div",{children:[e(U,{style:{color:"black"},iconProps:{iconName:"Lightbulb"},title:"Show thought process",ariaLabel:"Show thought process",onClick:()=>i(),disabled:!t.thoughts}),e(U,{style:{color:"black"},iconProps:{iconName:"ClipboardList"},title:"Show supporting content",ariaLabel:"Show supporting content",onClick:()=>n(),disabled:!t.data_points.length}),e(U,{style:{color:"black"},iconProps:{iconName:"ReadOutLoud"},title:"Read answer",ariaLabel:"Read answer",onClick:()=>l(),disabled:!t.answer})]})]})}),e(b.Item,{grow:!0,children:e("div",{className:N.answerText,dangerouslySetInnerHTML:{__html:m}})}),!!s.citations.length&&e(b.Item,{children:c(b,{horizontal:!0,wrap:!0,tokens:{childrenGap:5},children:[e("span",{className:N.citationLearnMore,children:"来源:"}),s.citations.map((u,g)=>{const v=u.path;return e("a",{className:N.citation,title:u.name,onClick:()=>a(v),children:`${++g}. ${u.name}`},g)})]})}),!!s.followupQuestions.length&&f&&r&&e(b.Item,{children:c(b,{horizontal:!0,wrap:!0,className:`${s.citations.length?N.followupQuestionsList:""}`,tokens:{childrenGap:6},children:[e("span",{className:N.followupQuestionLearnMore,children:"您可能还想问:"}),s.followupQuestions.map((u,g)=>e("a",{className:N.followupQuestion,title:u,onClick:()=>r(u),children:`${u}`},g))]})})]})}else if(Array.isArray(t.answer)){let s=t.answer;const m=h.useMemo(()=>Wt(s),[t]),u=de.sanitize(m);return c(b,{className:`${N.answerContainer} ${o&&N.selected}`,verticalAlign:"space-between",children:[e(b.Item,{children:c(b,{horizontal:!0,horizontalAlign:"space-between",children:[e(pe,{}),c("div",{children:[e(U,{style:{color:"black"},iconProps:{iconName:"Lightbulb"},title:"Show thought process",ariaLabel:"Show thought process",onClick:()=>i(),disabled:!t.thoughts}),e(U,{style:{color:"black"},iconProps:{iconName:"ClipboardList"},title:"Show supporting content",ariaLabel:"Show supporting content",onClick:()=>n(),disabled:!t.data_points.length}),e(U,{style:{color:"black"},iconProps:{iconName:"ReadOutLoud"},title:"Read answer",ariaLabel:"Read answer",onClick:()=>l(),disabled:!t.answer})]})]})}),e(b.Item,{grow:!0,children:e("div",{className:N.answerText,dangerouslySetInnerHTML:{__html:u}})})]})}else return null},Vt=()=>{const t=nt({from:{opacity:0},to:{opacity:1}});return e(ot.div,{style:{...t},children:c(b,{className:N.answerContainer,verticalAlign:"space-between",children:[e(pe,{}),e(b.Item,{grow:!0,children:c("p",{className:N.answerText,children:["正在生成回答",e("span",{className:N.loadingdots})]})})]})})},Ae=({error:t,onRetry:o})=>c(b,{className:N.answerContainer,verticalAlign:"space-between",children:[e(He,{"aria-hidden":"true","aria-label":"Error icon",primaryFill:"red"}),e(b.Item,{grow:!0,children:e("p",{className:N.answerText,children:t})}),e(Ge,{className:N.retryButton,onClick:o,text:"Retry"})]}),Jt="_questionInputContainer_sk61p_1",Xt="_questionInputTextArea_sk61p_10",Yt="_questionInputButtonsContainer_sk61p_15",Zt="_questionInputSendButton_sk61p_21",en="_questionInputSendButtonDisabled_sk61p_25",F={questionInputContainer:Jt,questionInputTextArea:Xt,questionInputButtonsContainer:Yt,questionInputSendButton:Zt,questionInputSendButtonDisabled:en},xe=({onSend:t,disabled:o,placeholder:a,clearOnSend:i})=>{const[n,r]=h.useState(""),l=()=>{if(o||!n.trim()){console.log("send disabled"),console.log("question: "+n);return}t(n),i&&r("")},f=()=>{const g="e985cb0392ad45d59681a396b208ebcf",v="southcentralus";var B=ve.fromSubscription(g,v);const k=ye.fromDefaultMicrophoneInput();B.speechRecognitionLanguage="zh-CN";const Q=new Qe(B,k);Q.recognizeOnceAsync(w=>{switch(w.reason){case Y.RecognizedSpeech:console.log(`RECOGNIZED: Text=${w.text}`),r(w.text);break;case Y.NoMatch:console.log("NOMATCH: Speech could not be recognized.");break;case Y.Canceled:const L=Oe.fromResult(w);console.log(`CANCELED: Reason=${L.reason}`),L.reason==ze.Error&&(console.log(`CANCELED: ErrorCode=${L.ErrorCode}`),console.log(`CANCELED: ErrorDetails=${L.errorDetails}`),console.log("CANCELED: Did you set the speech resource key and region values?"));break}Q.close()})},s=g=>{g.key==="Enter"&&!g.shiftKey&&(g.preventDefault(),l())},m=(g,v)=>{v?v.length<=1e3&&r(v):r("")},u=o||!n.trim();return c(b,{horizontal:!0,className:F.questionInputContainer,children:[e(H,{className:F.questionInputTextArea,placeholder:a,multiline:!0,resizable:!1,borderless:!0,value:n,onChange:m,onKeyDown:s}),c("div",{className:F.questionInputButtonsContainer,children:[e("div",{className:`${F.questionInputSendButton} ${u?F.questionInputSendButtonDisabled:""}`,"aria-label":"语音输入",onClick:f,children:e(Ue,{primaryFill:"rgba(115, 118, 225, 1)"})}),e("div",{className:`${F.questionInputSendButton} ${u?F.questionInputSendButtonDisabled:""}`,"aria-label":"提问按钮",onClick:l,children:e(Ke,{primaryFill:"rgba(115, 118, 225, 1)"})})]})]})},tn="_examplesNavList_1eu46_1",nn="_example_1eu46_1",on="_exampleText_1eu46_27",me={examplesNavList:tn,example:nn,exampleText:on},an=({text:t,value:o,onClick:a})=>e("div",{className:me.example,onClick:()=>a(o),children:e("p",{className:me.exampleText,children:t})}),sn=[{text:"2022-23赛季，NBA哪只球队常规赛战绩最好?",value:"2022-23赛季，NBA哪只球队常规赛战绩最好?"},{text:"What's the main goal of gpt model ?",value:"What's the main goal of gpt model ?"},{text:"涨幅最高的三只股票是？",value:"查询出涨幅最高的三只股票"}],Re=({onExampleClicked:t})=>e("ul",{className:me.examplesNavList,children:sn.map((o,a)=>e("li",{children:e(an,{text:o.text,value:o.value,onClick:t})},a))}),rn="_thoughtProcess_1rdxk_1",cn={thoughtProcess:rn};function ln(t){const o=t.split(": "),a=o[0];var i=o.slice(1).join(": ")?o.slice(1).join(": "):"No content";const n=i.match(/<([^>]+)>/);return i=i.replace(/<([^>]+)>/g,""),{title:a,content:i,url:n?n[1]:""}}const un="_supportingContentNavList_1yfye_1",dn="_supportingContentItem_1yfye_9",hn="_supportingContentItemHeader_1yfye_21",pn="_supportingContentItemText_1yfye_25",q={supportingContentNavList:un,supportingContentItem:dn,supportingContentItemHeader:hn,supportingContentItemText:pn},mn=({supportingContent:t})=>Array.isArray(t)?e("ul",{className:q.supportingContentNavList,children:t.map((o,a)=>{const i=ln(o);return c("li",{className:q.supportingContentItem,children:[e("h4",{className:q.supportingContentItemHeader,children:i.title}),e("p",{className:q.supportingContentItemText,children:i.content}),e("a",{className:q.supportingContentItemText,href:i.url,target:"_blank",children:i.url})]})})}):typeof t=="string"?e("ul",{className:q.supportingContentNavList,children:e("li",{className:q.supportingContentItem,children:e("p",{className:q.supportingContentItemText,children:t})})}):e("ul",{});var A=(t=>(t.ThoughtProcessTab="thoughtProcess",t.SupportingContentTab="supportingContent",t.CitationTab="citation",t))(A||{});const le={disabled:!0,style:{color:"grey"}},Le=({answer:t,activeTab:o,activeCitation:a,citationHeight:i,className:n,onActiveTabChanged:r})=>{const l=!t.thoughts,f=!t.data_points.length,s=!a,m=de.sanitize(t.thoughts);return c(We,{className:n,selectedKey:o,onLinkClick:u=>u&&r(u.props.itemKey),children:[e(ce,{itemKey:A.ThoughtProcessTab,headerText:"思维过程",headerButtonProps:l?le:void 0,children:e("div",{className:cn.thoughtProcess,dangerouslySetInnerHTML:{__html:m}})}),e(ce,{itemKey:A.SupportingContentTab,headerText:"支持内容",headerButtonProps:f?le:void 0,children:e(mn,{supportingContent:t.data_points})}),e(ce,{itemKey:A.CitationTab,headerText:"引用",headerButtonProps:s?le:void 0,children:e("iframe",{title:"引用",src:a,width:"100%",height:i})})]})},gn="_container_cfwv2_1",_n={container:gn},Ie=({className:t,onClick:o})=>c("div",{className:`${_n.container} ${t??""}`,onClick:o,children:[e(Ve,{}),e(be,{children:"开发人员配置"})]}),Cn=()=>{const[t,o]=h.useState(!1),[a,i]=h.useState(P.ReadDecomposeAsk),[n,r]=h.useState(""),[l,f]=h.useState(""),[s,m]=h.useState(""),[u,g]=h.useState(3),[v,B]=h.useState(!1),[k,Q]=h.useState(!1),[w,L]=h.useState(""),M=h.useRef(""),[D,K]=h.useState(!1),[$,j]=h.useState(),[x,O]=h.useState(),[G,E]=h.useState(),[z,I]=h.useState(void 0),W=async _=>{M.current=_,$&&j(void 0),K(!0),E(void 0),I(void 0);try{const C={question:_,approach:a,overrides:{promptTemplate:n.length===0?void 0:n,promptTemplatePrefix:l.length===0?void 0:l,promptTemplateSuffix:s.length===0?void 0:s,excludeCategory:w.length===0?void 0:w,top:u,semanticRanker:v,semanticCaptions:k}},Pe=await Rt(C);O(Pe)}catch(C){j(C)}finally{K(!1)}},Z=(_,C)=>{r(C||"")},ee=(_,C)=>{f(C||"")},te=(_,C)=>{m(C||"")},ne=(_,C)=>{g(parseInt(C||"3"))},oe=(_,C)=>{i((C==null?void 0:C.key)||P.RetrieveThenRead)},ae=(_,C)=>{B(!!C)},se=(_,C)=>{Q(!!C)},re=(_,C)=>{L(C||"")},V=_=>{W(_)},ie=_=>{G===_&&z===A.CitationTab?I(void 0):(E(_),I(A.CitationTab))},d=_=>{I(z===_?void 0:_)},p=()=>{alert("onReadAnswerClicked")},R=[{key:P.RetrieveThenRead,text:"Retrieve-Then-Read"},{key:P.ReadRetrieveRead,text:"Read-Retrieve-Read"},{key:P.ReadDecomposeAsk,text:"Read-Decompose-Ask"}];return c("div",{className:y.oneshotContainer,children:[c("div",{className:y.oneshotTopSection,children:[e(Ie,{className:y.settingsButton,onClick:()=>o(!t)}),e("h1",{className:y.oneshotTitle,children:"Ask your data"}),e("div",{className:y.oneshotQuestionInput,children:e(xe,{placeholder:"示例:查询出涨幅最高的三只股票",disabled:D,onSend:_=>W(_)})})]}),c("div",{className:y.oneshotBottomSection,children:[D&&e(Je,{label:"正在生成回答"}),!M.current&&e(Re,{onExampleClicked:V}),!D&&x&&!$&&e("div",{className:y.oneshotAnswerContainer,children:e(we,{answer:x,onCitationClicked:_=>ie(_),onThoughtProcessClicked:()=>d(A.ThoughtProcessTab),onSupportingContentClicked:()=>d(A.SupportingContentTab),onReadAnswerClicked:()=>p()})}),$?e("div",{className:y.oneshotAnswerContainer,children:e(Ae,{error:$.toString(),onRetry:()=>W(M.current)})}):null,z&&x&&e(Le,{className:y.oneshotAnalysisPanel,activeCitation:G,onActiveTabChanged:_=>d(_),citationHeight:"600px",answer:x,activeTab:z})]}),c(Ne,{headerText:"配置",isOpen:t,isBlocking:!1,onDismiss:()=>o(!1),closeButtonAriaLabel:"Close",onRenderFooterContent:()=>e(Te,{onClick:()=>o(!1),children:"Close"}),isFooterAtBottom:!0,children:[e(Xe,{className:y.oneshotSettingsSeparator,label:"方式",options:R,defaultSelectedKey:a,onChange:oe}),(a===P.RetrieveThenRead||a===P.ReadDecomposeAsk)&&e(H,{className:y.oneshotSettingsSeparator,defaultValue:n,label:"更改提问模板",multiline:!0,autoAdjustHeight:!0,onChange:Z}),a===P.ReadRetrieveRead&&c(he,{children:[e(H,{className:y.oneshotSettingsSeparator,defaultValue:l,label:"更改提问前缀模板",multiline:!0,autoAdjustHeight:!0,onChange:ee}),e(H,{className:y.oneshotSettingsSeparator,defaultValue:s,label:"更改提问后缀模板",multiline:!0,autoAdjustHeight:!0,onChange:te})]}),e(ke,{className:y.oneshotSettingsSeparator,label:"最多从搜索中返回的条目数量:",min:1,max:50,defaultValue:u.toString(),onChange:ne}),e(H,{className:y.oneshotSettingsSeparator,label:"排除类别",onChange:re}),e(J,{className:y.oneshotSettingsSeparator,checked:v,label:"使用语义搜索",onChange:ae}),e(J,{className:y.oneshotSettingsSeparator,checked:k,label:"使用查询上下文摘要而不是整个文档",onChange:se,disabled:!v})]})]})},fn="_container_18ti9_1",Sn="_chatRoot_18ti9_8",vn="_chatContainer_18ti9_13",yn="_chatEmptyState_18ti9_21",bn="_chatEmptyStateTitle_18ti9_31",Nn="_chatEmptyStateSubtitle_18ti9_38",Tn="_chatMessageStream_18ti9_54",kn="_chatMessageGpt_18ti9_66",wn="_chatMessageGptMinWidth_18ti9_73",An="_chatInput_18ti9_78",xn="_chatAnalysisPanel_18ti9_91",Rn="_chatSettingsSeparator_18ti9_99",Ln="_loadingLogo_18ti9_103",In="_commandsContainer_18ti9_107",Pn="_commandButton_18ti9_112",S={container:fn,chatRoot:Sn,chatContainer:vn,chatEmptyState:yn,chatEmptyStateTitle:bn,chatEmptyStateSubtitle:Nn,chatMessageStream:Tn,chatMessageGpt:kn,chatMessageGptMinWidth:wn,chatInput:An,chatAnalysisPanel:xn,chatSettingsSeparator:Rn,loadingLogo:Ln,commandsContainer:In,commandButton:Pn},En="_container_1rakl_1",Bn="_message_1rakl_9",Ce={container:En,message:Bn},ue=({message:t})=>e("div",{className:Ce.container,children:e("div",{className:Ce.message,children:t})}),Mn="_container_1opm5_1",Dn="_disabled_1opm5_8",fe={container:Mn,disabled:Dn},$n=({className:t,disabled:o,onClick:a})=>c("div",{className:`${fe.container} ${t??""} ${o&&fe.disabled}`,onClick:a,children:[e(Ye,{}),e(be,{children:"清空对话"})]}),jn=()=>{const[t,o]=h.useState(!1),[a,i]=h.useState(""),[n,r]=h.useState(3),[l,f]=h.useState(!1),[s,m]=h.useState(!1),[u,g]=h.useState(""),[v,B]=h.useState(!0),k=h.useRef(""),Q=h.useRef(null),[w,L]=h.useState(!1),[M,D]=h.useState(),[K,$]=h.useState(),[j,x]=h.useState(void 0),[O,G]=h.useState(0),[E,z]=h.useState([]),I=async d=>{k.current=d,M&&D(void 0),L(!0),$(void 0),x(void 0);try{const R={history:[...E.map(C=>({user:C[0],bot:C[1].answer})),{user:d,bot:void 0}],approach:P.ReadRetrieveRead,overrides:{promptTemplate:a.length===0?void 0:a,excludeCategory:u.length===0?void 0:u,top:n,semanticRanker:l,semanticCaptions:s,suggestFollowupQuestions:v}},_=await Lt(R);z([...E,[d,_]])}catch(p){D(p)}finally{L(!1)}},W=()=>{k.current="",M&&D(void 0),$(void 0),x(void 0),z([])};h.useEffect(()=>{var d;return(d=Q.current)==null?void 0:d.scrollIntoView({behavior:"smooth"})},[w]);const Z=(d,p)=>{i(p||"")},ee=(d,p)=>{r(parseInt(p||"3"))},te=(d,p)=>{f(!!p)},ne=(d,p)=>{m(!!p)},oe=(d,p)=>{g(p||"")},ae=(d,p)=>{B(!!p)},se=d=>{I(d)},re=(d,p)=>{K===d&&j===A.CitationTab&&O===p?x(void 0):($(d),x(A.CitationTab)),G(p)},V=(d,p)=>{x(j===d&&O===p?void 0:d),G(p)},ie=async(d,p)=>{G(p);try{const R={answer:d.answer};await It(R)}catch(R){D(R)}finally{L(!1)}};return c("div",{className:S.container,children:[c("div",{className:S.commandsContainer,children:[e($n,{className:S.commandButton,onClick:W,disabled:!k.current||w}),e(Ie,{className:S.commandButton,onClick:()=>o(!t)})]}),c("div",{className:S.chatRoot,children:[c("div",{className:S.chatContainer,children:[k.current?c("div",{className:S.chatMessageStream,children:[E.map((d,p)=>c("div",{children:[e(ue,{message:d[0]}),e("div",{className:S.chatMessageGpt,children:e(we,{answer:d[1],isSelected:O===p&&j!==void 0,onCitationClicked:R=>re(R,p),onThoughtProcessClicked:()=>V(A.ThoughtProcessTab,p),onSupportingContentClicked:()=>V(A.SupportingContentTab,p),onFollowupQuestionClicked:R=>I(R),onReadAnswerClicked:()=>ie(d[1],p),showFollowupQuestions:v&&E.length-1===p},p)})]},p)),w&&c(he,{children:[e(ue,{message:k.current}),e("div",{className:S.chatMessageGptMinWidth,children:e(Vt,{})})]}),M?c(he,{children:[e(ue,{message:k.current}),e("div",{className:S.chatMessageGptMinWidth,children:e(Ae,{error:M.toString(),onRetry:()=>I(k.current)})})]}):null,e("div",{ref:Q})]}):c("div",{className:S.chatEmptyState,children:[e(Ze,{fontSize:"120px",primaryFill:"rgba(115, 118, 225, 1)","aria-hidden":"true","aria-label":"Chat logo"}),e("h1",{className:S.chatEmptyStateTitle,children:"Chat with your documents"}),e("h2",{className:S.chatEmptyStateSubtitle,children:"Ask anything or try an example"}),e(Re,{onExampleClicked:se})]}),e("div",{className:S.chatInput,children:e(xe,{clearOnSend:!0,placeholder:"输入问题",disabled:w,onSend:d=>I(d)})})]}),E.length>0&&j&&e(Le,{className:S.chatAnalysisPanel,activeCitation:K,onActiveTabChanged:d=>V(d,O),citationHeight:"810px",answer:E[O][1],activeTab:j}),c(Ne,{headerText:"配置",isOpen:t,isBlocking:!1,onDismiss:()=>o(!1),closeButtonAriaLabel:"Close",onRenderFooterContent:()=>e(Te,{onClick:()=>o(!1),children:"Close"}),isFooterAtBottom:!0,children:[e(H,{className:S.chatSettingsSeparator,defaultValue:a,label:"更改提问模板",multiline:!0,autoAdjustHeight:!0,onChange:Z}),e(ke,{className:S.chatSettingsSeparator,label:"最多从搜索中返回的条目数量:",min:1,max:50,defaultValue:n.toString(),onChange:ee}),e(H,{className:S.chatSettingsSeparator,label:"排除类别",onChange:oe}),e(J,{className:S.chatSettingsSeparator,checked:l,label:"使用语义搜索",onChange:te}),e(J,{className:S.chatSettingsSeparator,checked:s,label:"使用查询上下文摘要而不是整个文档",onChange:ne,disabled:!l}),e(J,{className:S.chatSettingsSeparator,checked:v,label:"建议后续问题",onChange:ae})]})]})]})};et();tt();function qn(){return e(De,{children:e(je,{children:c(X,{path:"/",element:e(ft,{}),children:[e(X,{index:!0,element:e(jn,{})}),e(X,{path:"qa",element:e(Cn,{})}),e(X,{path:"*",element:e(St,{})})]})})})}Be.createRoot(document.getElementById("root")).render(e(Ee.StrictMode,{children:e(qn,{})}));
//# sourceMappingURL=index-6d9715c6.js.map
